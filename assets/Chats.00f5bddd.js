import{r as n,b as t,g as E,u as p,a as b,e as y,R as I,j as s,c as N,F as R,L as M,i as L}from"./index.4c6c3d2a.js";import{A as k,u as _,h as O,b as A,i as v,j as T,s as C,I as S,k as z,l as B}from"./useFormRegister.1f1747e4.js";import{_ as U}from"./_virtual___federation__.8ee5a4c5.js";const $=await U("auth","./Modal");let{ProfileModal:P}=$;const j=()=>{const e=n.exports.useRef(null);return n.exports.useEffect(()=>{P(e.current)},[]),t("div",{ref:e})};function D(){const e=sessionStorage.getItem("theme")==="dark"?"light":"dark";return sessionStorage.setItem("theme",e),{type:E,theme:e}}const F=({isShown:e,onClose:r})=>{const a=n.exports.useRef(null),o=n.exports.useRef(document.getElementById("modal-root")),i=p(),{theme:d}=b(l=>l.themeReducer),g=()=>i(D()),[u,m]=n.exports.useState(!1),h=y(),x=n.exports.useCallback(l=>{const w=l.target;!w||!a.current||a.current?.contains(w)||(r(),m(()=>!1),o.current.classList.add("z-[-1]","cursor-default"))},[]);n.exports.useLayoutEffect(()=>(o.current?.addEventListener("click",x),()=>o.current?.removeEventListener("click",x)),[]);const c="relative bg-[#242526] p-2 z-10 text-white transition-all w-[80vw] cursor-default max-w-[320px] full-vh "+(e?"translate-x-[0]":"translate-x-[-100vw]"),f=[{name:"chats",icon:"fa-solid fa-comment"},{name:"marketplace",icon:"fa-solid fa-store"},{name:"archive",icon:"fa-solid fa-box-archive"}];return I.createPortal(s("aside",{ref:a,className:c,children:[s("header",{className:"flex relative justify-between items-center px-4 py-3",children:[t(k,{imgUrl:N.getLoggedInUser().photo,imgSize:"sm",className:"cursor-pointer"}),s("h4",{className:"grow ml-8 cursor-pointer",onClick:()=>m(l=>!l),children:[N.getLoggedInUser().fullname," ",t("i",{className:`fa-solid fa-chevron-${u?"down":"up"}`})]}),t("span",{className:"fa-solid fa-gear cursor-pointer",onClick:()=>m(l=>!l)}),u&&t(j,{})]}),s("section",{className:"flex flex-col capitalize",children:[f.map(l=>s("div",{className:`flex items-center cursor-pointer hover:bg-gray-500 rounded p-3 text-white ${h.pathname.includes(l.name)?"bg-gray-600":""} ${l.name==="marketplace"?"relative left-[-2px]":""}`,children:[t("span",{className:l.icon+" bg-slate-500 px-2 py-1 rounded mr-11 text-xl"}),t("p",{children:l.name})]},l.name)),s("div",{onClick:()=>g(),className:"flex items-center cursor-pointer hover:bg-gray-500 rounded p-3 text-white",children:[t("span",{className:`fa-solid ${d==="dark"?"fa-moon":"fa-sun"} bg-slate-500 px-2 py-1 rounded mr-11 text-xl`}),t("p",{children:"Theme"})]})]})]}),o.current)},V=()=>{const e=n.exports.useRef(document.getElementById("modal-root")),r=n.exports.useCallback(()=>{o(()=>!0),e.current.classList.remove("z-[-1]","cursor-default"),e.current.classList.add("cursor-pointer","opacity-05")},[]),[a,o]=n.exports.useState(!1);return s(R,{children:[s("header",{className:"flex items-center py-4 px-2 justify-between max-w-[550px]",children:[t("span",{onClick:()=>r(),className:"fa-solid fa-bars bg-slate-300 dark:bg-slate-700  rounded-full p-2 cursor-pointer"}),t("h1",{className:"absolute left-16",children:"Chats"}),t("span",{className:"fa-solid fa-pen bg-slate-300 rounded-full p-2 cursor-pointer hover:cursor-not-allowed dark:bg-slate-700"})]}),t(F,{isShown:a,onClose:()=>o(()=>!1)})]})},H=e=>{const a=y().pathname.split("/").at(-1);return t(M,{to:`/chats/${e.chat.chatId}`,children:s("div",{className:`profile-preview rounded p-2 flex items-center cursor-pointer hover:bg-slate-200 hover:dark:bg-[rgba(45,136,255,0.1)] ${e.chat.chatId===a?"bg-slate-200 dark:bg-[rgba(45,136,255,0.1)]":""}`,children:[t(k,{imgSize:"lg",imgUrl:e.chat.user?.[0].photo||""}),s("div",{className:"flex flex-col pl-3",children:[t("h4",{children:e.chat.user?.[0].fullname}),e.chat.lastMsg&&s("span",{className:"text-[#65676B] dark:text-[#B0B3B8]",children:[_.timeAgo(e.chat.lastMsg.timestamp)+" ",s("span",{children:[e.chat.lastMsg.txt?"\xB7 ":"",e.chat.lastMsg.txt?.length>28?`${e.chat.lastMsg.txt.slice(0,29)}...`:e.chat.lastMsg.txt]})]})]})]})})},G=e=>t("div",{className:"grow overflow-y-auto",children:e.chats.map(r=>t(H,{chat:r},r._id))}),J=e=>{const r=L(),a=p(),o=i=>{e.clearContacts(),a(O(i)).then(d=>r(`/chats/${d}`))};return s("div",{className:"w-full py-6 z-5 rounded flex items-center cursor-pointer p-2 hover:bg-slate-200 bg-white dark:bg-[#3a3b3c]",onClick:()=>o(e.user),children:[t(k,{imgSize:"lg",imgUrl:e.user.photo||""}),s("h4",{className:"pl-2",children:[" ",e.user.fullname]})]})},q=()=>{const e=p(),r=b(c=>c.chatReducer.contacts),[a,o]=n.exports.useState(null),i=()=>e(v()),d=({txt:c})=>{c||i(),a&&a.abort();const f=new AbortController;o(f),e(T(c,f.signal))},g=_.debounce(d,400),{register:u,resetForm:m}=A({txt:""},g),h=n.exports.useRef(null);return s("form",{onSubmit:c=>{c.preventDefault()},onClick:()=>h.current?.focus(),className:"hover:cursor-text max-w-[550px] relative z-0",children:[s("div",{className:"input-group py-4 relative z-[-5] w-full text-gray-400",children:[t("span",{className:"fa-solid fa-magnifying-glass absolute text-sm  top-[2.2rem] left-4 dark:text-[#606770]"}),t("input",{ref:h,placeholder:"Search",className:"px-12 py-4 text-[#050505] bg-[rgba(134,142,153,0.1)]  dark:text-[#606770] rounded-full border-none outline-none w-full dark:bg-[#3a3b3c]",type:"text",...u("txt")})]}),u("txt").value&&t("span",{onClick:c=>{c.stopPropagation(),v(),m()},className:"fa-solid fa-times absolute cursor-pointer top-[2.35rem] right-8 text-gray-400"}),r&&t("div",{className:"contacts-modal flex flex-col absolute w-full max-h-[375px] overflow-y-auto",children:r.map(c=>t(J,{user:c,clearContacts:i},c._id))})]})},X=()=>{const e=p(),{chats:r}=b(a=>a.chatReducer);return n.exports.useEffect(()=>{const a=window.navigator.userAgent.indexOf("Mobile")!==-1,o=sessionStorage.getItem("alreadyLoaded");a&&o&&JSON.parse(o)&&(window.location.reload(),sessionStorage.setItem("alreadyLoaded","true"))},[]),n.exports.useEffect(()=>(C.on(S.SERVER_EMIT_CONVERSATION_UPDATE,a=>e(z(a))),e(B()),()=>{v(),C.off(S.SERVER_EMIT_CONVERSATION_UPDATE)}),[]),s("section",{className:"chat-list p-4 full-vh flex flex-col shadow-[0_0_4px_0_#00000033] dark:bg-[#242526] dark:text-white dark:shadow-[inset_-1px_0_0_0_#ffffff33]",children:[t(V,{}),t(q,{}),t(G,{chats:r||[]})]})};export{X as default};
